<script>
  const reloadChannel = new BroadcastChannel("reload-channel");
  reloadChannel.onmessage = (event) => {
    if (event.data === "reload") {
      console.log("üîÅ Nh·∫≠n t√≠n hi·ªáu reload t·ª´ selectfile.html");
      location.reload();
    }
  };
</script>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz System</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <!-- N√∫t hamburger (th√™m v√†o ƒë·∫ßu .main-content ho·∫∑c m·ªôt v·ªã tr√≠ c·ªë ƒë·ªãnh) -->
    <button class="hamburger-btn hidden" id="hamburger-btn">‚ò∞</button>

    <!-- C·∫•u tr√∫c container hi·ªán t·∫°i -->
    <div class="container">
      <!-- Sidebar b√™n tr√°i: danh s√°ch c√¢u h·ªèi + Auto Next + N·ªôp b√†i -->
      <div class="sidebar" id="sidebar">
        <div class="auto-next">
          <label for="sidebar-auto-next">Auto Next:</label>
          <select id="sidebar-auto-next">
            <option value="0">T·∫Øt</option>
            <option value="1000">1 gi√¢y</option>
            <option value="2000">2 gi√¢y</option>
            <option value="3000">3 gi√¢y</option>
          </select>
        </div>
        <h3>Questions</h3>
        <div class="question-boxes" id="question-list"></div>
        <div class="sidebar-bottom"></div>

        <button onclick="handleSubmit()" class="submit-btn">N·ªôp b√†i</button>
      </div>

      <!-- Thanh tien trinh vui nhon -->
      <div id="quiz-progress-container">
        <div id="quiz-progress-bar"></div>
        <span id="quiz-progress-text">B·∫Øt ƒë·∫ßu nh√©!</span>
      </div>

      <!-- Ph·∫ßn ch√≠nh gi·ªØa: hi·ªÉn th·ªã c√¢u h·ªèi v√† l·ª±a ch·ªçn -->
      <div class="main-content">
        <div class="quiz-container">
          <div class="question" id="question-text"></div>
          <div class="options" id="options"></div>
          <div class="navigation">
            <button onclick="prevQuestion()">Previous</button>
            <button onclick="nextQuestion()">Next</button>
          </div>
        </div>
      </div>

      <!-- B·∫£ng b√™n ph·∫£i: th√¥ng tin th·ªùi gian + ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn admin -->
      <div class="right-panel">
        <div id="user-info" style="display: block">
          <p><span id="user-name"></span></p>
          <button onclick="showLoginForm()" class="login-btn">Login</button>
          <button onclick="handleLogout()" class="logout-btn hidden">
            Logout
          </button>
        </div>
        <h3>Th·ªùi gian c√≤n l·∫°i:</h3>
        <p id="countdown">--:--</p>
        <br />
        <h3>Th√¥ng tin</h3>
        <p>Ch·∫ø ƒë·ªô: <span id="mode-label">Ch∆∞a ch·ªçn</span></p>
        <p>Th·ªùi gian: <span id="time-info">Kh√¥ng gi·ªõi h·∫°n</span></p>
        <button style="background-color: aqua; width: 100%; margin-top: 10px; border-radius: 10px; height: 50px;">
          <a
            href="http://localhost:5000/admin/selectfile.html"
            style="color: white; text-decoration: none; font-weight: bold;"
          >
            Ch·ªçn file c√¢u h·ªèi
          </a>
        </button>
      </div>
    </div>

    <!-- N√∫t ƒë·ªïi giao di·ªán Light/Dark -->
    <div class="toggle-theme">
      <button onclick="toggleTheme()">Toggle Dark/Light</button>
    </div>

    <!-- Popup: Ch·ªçn ch·∫ø ƒë·ªô l√†m b√†i -->
    <div class="popup-overlay" id="settings-popup">
      <div class="popup">
        <h2 style="color: silver">‚öôÔ∏è Select Quiz Mode</h2>

        <div class="time-limit">
          <label for="time-limit-select">üïíTh·ªùi gian l√†m b√†i:</label>
          <select id="time-limit-select">
            <option value="0">Kh√¥ng gi·ªõi h·∫°n</option>
            <option value="15">15 ph√∫t</option>
            <option value="30">30 ph√∫t</option>
            <option value="60">60 ph√∫t</option>
          </select>
        </div>

        <div class="auto-next">
          <label for="popup-auto-next">üïíAuto Next:</label>
          <select id="popup-auto-next">
            <option value="0">T·∫Øt</option>
            <option value="1000">1 gi√¢y</option>
            <option value="2000">2 gi√¢y</option>
            <option value="3000">3 gi√¢y</option>
          </select>
        </div>

        <button id="btn-mode-1" onclick="startQuiz(false, false, false)">
          üéÆCh·∫ø ƒë·ªô b√¨nh th∆∞·ªùng
        </button>
        <button id="btn-mode-2" onclick="handleStartQuiz(true, true, false)">
          üéÆX√°o tr·ªôn C√¢u h·ªèi & ƒê√°p √°n
        </button>
        <button id="btn-mode-3" onclick="handleStartQuiz(false, true, false)">
          üéÆ X√°o tr·ªôn ƒê√°p √°n
        </button>
        <button id="btn-mode-4" onclick="handleStartQuiz(false, true, true)">
          -------------------- ‚ù§Ô∏èHI·ªÜN ƒê√öNG SAI‚ù§Ô∏è --------------------
        </button>
      </div>
    </div>

    <!-- Popup: X√°c nh·∫≠n n·ªôp b√†i -->
    <div id="confirm-submit-popup" class="popup-overlay hidden">
      <div class="popup">
        <h2 style="color: darkgray">X√°c nh·∫≠n n·ªôp b√†i?</h2>
        <button onclick="confirmSubmit()">N·ªôp b√†i</button>
        <button onclick="closeConfirmPopup()">H·ªßy</button>
      </div>
    </div>

    <!-- Popup: Hi·ªÉn th·ªã k·∫øt qu·∫£ sau khi n·ªôp b√†i -->
    <div id="score-popup" class="popup-overlay hidden">
      <div class="popup">
        <h2>K·∫øt qu·∫£</h2>
        <div id="score-detail">B·∫°n ƒë√∫ng X/Y c√¢u.</div>
        <div id="score-chart"></div>
        <div
          id="score-feedback"
          style="margin-top: 10px; font-weight: bold; font-size: 16px"
        >
          <!-- C√¢u ƒë√°nh gi√° s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
        </div>
        <button onclick="startWrongQuestionsQuiz()">
          L√†m l·∫°i c√°c c√¢u ƒë√£ t·ª´ng sai
        </button>
        <button onclick="closeScorePopup()">ƒê√≥ng || Tho√°t</button>
      </div>
    </div>
    <!-- Popup: ƒêƒÉng nh·∫≠p v√† ƒëƒÉng k√Ω -->
    <div id="login-popup" class="popup-overlay">
      <div class="popup">
        <!-- Form ƒëƒÉng nh·∫≠p admin -->
        <div id="login-form">
          <h2 class="title-form">Login</h2>
          <input type="text" id="admin-username" placeholder="T√™n ƒëƒÉng nh·∫≠p" />
          <input type="password" id="admin-password" placeholder="M·∫≠t kh·∫©u" />
          <div id="login-error" style="color: red; margin-top: 10px"></div>
          <button onclick="handleLogin()">ƒêƒÉng nh·∫≠p</button>
          <button onclick="closeLoginPopup()">H·ªßy</button>
          <span class="toggle-link" onclick="showRegisterForm()"
            >Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</span
          >
        </div>
        <!-- Form ƒëƒÉng k√Ω -->
        <div id="register-form" style="display: none">
          <h2 class="title-form">Register</h2>
          <input
            type="text"
            id="register-username"
            placeholder="T√™n ƒëƒÉng nh·∫≠p"
            required
          />
          <input
            type="email"
            id="register-email"
            placeholder="Email"
            required
          />
          <input
            type="password"
            id="register-password"
            placeholder="M·∫≠t kh·∫©u"
            required
          />
          <button onclick="handleRegister()">ƒêƒÉng K√Ω</button>
          <button onclick="closeLoginPopup()">H·ªßy</button>
          <div id="register-error" style="color: red; margin-top: 10px"></div>
          <span class="toggle-link" onclick="showLoginForm()"
            >ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p</span
          >
        </div>
      </div>
    </div>

    <!-- Google Charts ƒë·ªÉ v·∫Ω bi·ªÉu ƒë·ªì k·∫øt qu·∫£ -->
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>

    <!-- Script ch√≠nh c·ªßa quiz -->
    <script src="script.js"></script>
  </body>
</html>
